tinymce.PluginManager.add("b_button",function(a){function b(b){return function(){var c=a.settings.link_list;"string"==typeof c?tinymce.util.XHR.send({url:c,success:function(a){b(tinymce.util.JSON.parse(a))}}):"function"==typeof c?c(b):b(c)}}function c(a,b,c){function d(a,c){return c=c||[],tinymce.each(a,function(a){var e={text:a.text||a.title};a.menu?e.menu=d(a.menu):(e.value=a.value,b&&b(e)),c.push(e)}),c}return d(a,c||[])}function d(b){function u(a){var b=j.find("#text");(!b.value()||a.lastControl&&b.value()==a.lastControl.text())&&b.value(a.control.text()),j.find("#href").value(a.control.value())}function v(b){var c=[];if(tinymce.each(a.dom.select("a:not([href])"),function(a){var d=a.name||a.id;d&&c.push({text:d,value:"#"+d,selected:b.indexOf("#"+d)!=-1})}),c.length)return c.unshift({text:"None",value:""}),{name:"anchor",type:"listbox",label:"Anchors",values:c,onselect:u}}function w(){!i&&0===d.text.length&&k&&this.parent().parent().find("#text")[0].value(this.value())}function x(b){var c=b.meta||{};m&&m.value(a.convertURL(this.value(),"href")),tinymce.each(b.meta,function(a,b){j.find("#"+b).value(a)}),c.text||w.call(this)}function y(a){var b=e.getContent();if(/</.test(b)&&(!/^<a [^>]+>[^<]+<\/a>$/.test(b)||b.indexOf("href=")==-1))return!1;if(a){var d,c=a.childNodes;if(0===c.length)return!1;for(d=c.length-1;d>=0;d--)if(3!=c[d].nodeType)return!1}return!0}var g,h,i,j,k,l,m,n,o,p,q,r,s,t,d={},e=a.selection,f=a.dom;g=e.getNode(),h=f.getParent(g,"a[href]"),k=y(),d.text=i=h?h.innerText||h.textContent:e.getContent({format:"text"}),h?d.target=f.getAttrib(h,"target"):a.settings.default_link_target&&(d.target=a.settings.default_link_target),(r=f.getAttrib(h,"rel"))&&(d.rel=r),(r=f.getAttrib(h,"btn_class"))&&(d.btn_class=r),(r=f.getAttrib(h,"size_class"))&&(d.size_class=r),(r=f.getAttrib(h,"title"))&&(d.title=r),d.href=h?f.getAttrib(h,"href"):"",k&&(l={name:"text",type:"textbox",size:40,label:"Text to display",onchange:function(){d.text=this.value()}}),b&&(m={type:"listbox",label:"Link list",values:c(b,function(b){b.value=a.convertURL(b.value||b.url,"href")},[{text:"None",value:""}]),onselect:u,value:a.convertURL(d.href,"href"),onPostRender:function(){m=this}}),a.settings.target_list!==!1&&(a.settings.target_list||(a.settings.target_list=[{text:"None",value:""},{text:"New window",value:"_blank"}]),o={name:"target",type:"listbox",label:"Target",values:c(a.settings.target_list)}),a.settings.btn_class!==!1&&(a.settings.btn_class||(a.settings.btn_class=[{text:"Default",value:"btn btn-default"},{text:"Primary",value:"btn btn-primary"},{text:"Success",value:"btn btn-success"},{text:"Info",value:"btn btn-info"},{text:"Warning",value:"btn btn-warning"},{text:"Danger",value:"btn btn-danger"}]),s={name:"btn_class",type:"listbox",label:"Button Class",values:c(a.settings.btn_class)}),a.settings.size_class!==!1&&(a.settings.size_class||(a.settings.size_class=[{text:"None",value:""},{text:"Large",value:" btn-lg"},{text:"Small",value:" btn-sm"},{text:"Extra Small",value:" btn-xs"}]),t={name:"size_class",type:"listbox",label:"Size Class",values:c(a.settings.size_class)}),a.settings.rel_list&&(n={name:"rel",type:"listbox",label:"Rel",values:c(a.settings.rel_list)}),a.settings.link_title!==!1&&(q={name:"title",type:"textbox",label:"Title",value:d.title}),j=a.windowManager.open({title:"Insert Bootstrap Button",data:d,body:[{name:"href",type:"filepicker",filetype:"file",size:40,autofocus:!0,label:"Url",onchange:x,onkeyup:w},l,q,v(d.href),m,n,o,p,s,t],onSubmit:function(b){function g(b,c){var d=a.selection.getRng();tinymce.util.Delay.setEditorTimeout(a,function(){a.windowManager.confirm(b,function(b){a.selection.setRng(d),c(b)})})}function j(){var b={target:d.target?d.target:null,rel:d.rel?d.rel:null,class:d.btn_class+d.size_class,title:d.title?d.title:null,role:"button",href:c};h?(a.focus(),k&&d.text!=i&&("innerText"in h?h.innerText=d.text:h.textContent=d.text),f.setAttribs(h,b),e.select(h),a.undoManager.add()):k?a.insertContent(f.createHTML("a",b,f.encode(d.text))):a.execCommand("mceInsertLink",!1,b)}var c;return d=tinymce.extend(d,b.data),(c=d.href)?c.indexOf("@")>0&&c.indexOf("//")==-1&&c.indexOf("mailto:")==-1?void g("The URL you entered seems to be an email address. Do you want to add the required mailto: prefix?",function(a){a&&(c="mailto:"+c),j()}):a.settings.link_assume_external_targets&&!/^\w+:/i.test(c)||!a.settings.link_assume_external_targets&&/^\s*www[\.|\d\.]/i.test(c)?void g("The URL you entered seems to be an external link. Do you want to add the required http:// prefix?",function(a){a&&(c="http://"+c),j()}):void j():void a.execCommand("unlink")}})}a.addButton("b_button",{icon:"glyphicons guicon guicon-button",tooltip:"Insert Button",onclick:b(d)}),this.showDialog=d,a.addMenuItem("b_button",{icon:"glyphicons guicon guicon-button",text:"Button",onclick:b(d),context:"insert",prependToContext:!0})});